<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NextExt - Enhanced Notepad</title>
  <link href="./output.css" rel="stylesheet" />
  <!-- Add Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* GitHub Dark Mode Color Palette */
    :root {
      --color-canvas-default: #0d1117;
      --color-canvas-subtle: #161b22;
      --color-canvas-inset: #010409;
      --color-border-default: #30363d;
      --color-border-muted: #21262d;
      --color-fg-default: #c9d1d9;
      --color-fg-muted: #8b949e;
      --color-fg-subtle: #6e7681;
      --color-accent-fg: #58a6ff;
      --color-accent-emphasis: #1f6feb;
      --color-success-fg: #3fb950;
      --color-danger-fg: #f85149;
      --color-attention-fg: #d29922;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      color: var(--color-fg-default);
      background-color: var(--color-canvas-default);
    }

    /* GitHub Dark Mode Tabs */
    .tab-active {
      border-bottom: 2px solid var(--color-accent-emphasis) !important;
      background-color: var(--color-canvas-default) !important;
      color: var(--color-fg-default) !important;
      font-weight: 600;
    }

    /* GitHub Dark Mode Sidebar Files */
    .sidebar-file:hover {
      background-color: var(--color-canvas-subtle);
    }
    .sidebar-file.active {
      background-color: var(--color-canvas-subtle);
      border-left: 3px solid var(--color-accent-emphasis);
      color: var(--color-accent-fg);
    }

    /* GitHub Close Button */
    .tab-close:hover {
      background-color: var(--color-danger-fg);
      color: white;
    }

    /* GitHub Dark Mode Scrollbars */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    ::-webkit-scrollbar-track {
      background: var(--color-canvas-subtle);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--color-border-default);
      border-radius: 6px;
      border: 2px solid var(--color-canvas-subtle);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #484f58;
    }

    /* Input and Textarea Focus */
    .gh-input-focus:focus {
      box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
      border-color: var(--color-accent-fg) !important;
      outline: none;
    }

    /* GitHub-like animations */
    .gh-transition {
      transition: all 0.2s ease;
    }
    
    /* Animation for status messages */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in;
    }
  </style>
</head>
<body class="flex flex-col h-screen bg-[#0d1117] text-[#c9d1d9]">
  <header class="p-3 text-white bg-[#161b22] shadow-md border-b border-[#30363d]">
    <div class="flex items-center justify-between">
      <h1 class="flex items-center text-xl font-bold">
        <i class="fas fa-code-branch mr-2 text-[#58a6ff]"></i>
        NextExt
      </h1>
      <div class="space-x-2">
        <button id="newBtn" class="px-3 py-1.5 text-sm transition bg-[#21262d] rounded-md hover:bg-[#30363d] border border-[#30363d] gh-transition">
          <i class="mr-1 text-xs fas fa-plus"></i>New
        </button>
        <button id="openBtn" class="px-3 py-1.5 text-sm transition bg-[#21262d] rounded-md hover:bg-[#30363d] border border-[#30363d] gh-transition">
          <i class="mr-1 text-xs fas fa-folder-open"></i>Open
        </button>
        <button id="saveBtn" class="px-3 py-1.5 text-sm transition bg-[#238636] rounded-md hover:bg-[#2ea043] text-white border border-[rgba(240,246,252,0.1)] gh-transition">
          <i class="mr-1 text-xs fas fa-save"></i>Save
        </button>
      </div>
    </div>
  </header>
  
  <!-- Tab bar for open files -->
  <div class="flex overflow-x-auto bg-[#161b22] border-b border-[#30363d]" id="tabs-container">
    <!-- Tabs will be dynamically added here -->
  </div>
  
  <div class="flex flex-1 overflow-hidden">
    <!-- Sidebar for file listing -->
    <div class="flex flex-col bg-[#0d1117] border-r border-[#30363d]" style="width: 240px;">
      <div class="flex items-center justify-between p-3 bg-[#161b22] border-b border-[#30363d]">
        <h2 class="font-semibold text-sm uppercase tracking-wide text-[#8b949e]">Files</h2>
        <button id="refreshFilesBtn" class="p-1 text-[#8b949e] hover:text-[#58a6ff] gh-transition">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
      <div id="file-explorer" class="flex-1 overflow-y-auto">
        <!-- Files will be listed here -->
        <div class="py-8 px-4 text-center text-[#8b949e]" id="empty-explorer-message">
          <i class="mb-2 text-3xl fas fa-folder-open"></i>
          <p>No files found</p>
          <p class="text-xs mt-1 text-[#6e7681]">Save a file to see it here</p>
        </div>
      </div>
    </div>
    
    <!-- Main content area -->
    <main class="flex flex-col flex-1 p-4 overflow-hidden bg-[#0d1117]">
      <div class="mb-4">
        <input type="text" id="noteTitle" placeholder="Note Title" 
               class="w-full p-2 border bg-[#0d1117] border-[#30363d] rounded text-[#c9d1d9] placeholder-[#6e7681] shadow-sm gh-input-focus gh-transition">
      </div>
      <div class="flex flex-col flex-1">
        <textarea id="noteContent" placeholder="Start typing your note here..."
                  class="w-full h-full p-4 border bg-[#0d1117] border-[#30363d] rounded text-[#c9d1d9] placeholder-[#6e7681] shadow-sm resize-none font-mono gh-input-focus gh-transition">
        </textarea>
      </div>
    </main>
  </div>
  
  <footer class="flex justify-between p-2 text-sm text-center text-[#8b949e] bg-[#161b22] border-t border-[#30363d]">
    <span class="flex items-center">
      <i class="fas fa-code text-[#58a6ff] mr-2"></i>
      Created with Electron and Tailwind CSS
    </span>
    <span id="status-message" class="px-2"></span>
  </footer>

  <script src="./app.js"></script>
  <script>
    // Enhance UI without changing core functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Store the original functions to ensure we don't lose functionality
      const originalCreateFileElement = window.createFileElement;
      const originalCreateTabForFile = window.createTabForFile;
      const originalSwitchToFile = window.switchToFile;
      const originalUpdateStatusMessage = window.updateStatusMessage;
      
      // Only override if the original functions exist
      if (originalCreateTabForFile) {
        // Override tab creation for GitHub dark mode styling
        window.createTabForFile = function(file, index) {
          const tab = document.createElement('div');
          tab.className = 'py-2 px-3 border-r border-[#30363d] text-[#8b949e] hover:bg-[#30363d] hover:text-[#c9d1d9] cursor-pointer gh-transition flex items-center';
          tab.dataset.index = index;
          
          tab.innerHTML = `
            <span class="truncate max-w-[120px]">${file.title}${file.isModified ? ' â€¢' : ''}</span>
            <button class="tab-close ml-2 p-0.5 rounded-full hover:bg-[#f85149] text-xs opacity-70 hover:opacity-100 gh-transition">
              <i class="fas fa-times"></i>
            </button>
          `;
          
          tab.addEventListener('click', (e) => {
            if (!e.target.closest('.tab-close')) {
              switchToFile(parseInt(tab.dataset.index));
            }
          });
          
          const closeBtn = tab.querySelector('.tab-close');
          closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeFile(parseInt(tab.dataset.index));
          });
          
          document.getElementById('tabs-container').appendChild(tab);
        };
      }
      
      if (originalCreateFileElement) {
        // Override file element creation - KEEPING THE ORIGINAL CLICK HANDLER LOGIC
        window.createFileElement = function(file) {
          const fileElement = document.createElement('div');
          fileElement.className = 'sidebar-file py-1.5 px-3 cursor-pointer flex items-center text-[#c9d1d9] hover:bg-[#161b22] gh-transition';
          fileElement.dataset.path = file.path;
          fileElement.innerHTML = `
            <i class="fas fa-file-alt text-[#8b949e] mr-2"></i>
            <span class="truncate">${file.name}</span>
          `;
          
          // Use the exact same click handler logic, just styled differently
          fileElement.addEventListener('click', async () => {
            try {
              const result = await window.electronAPI.readFile(file.path);
              if (result.success) {
                const existingIndex = openFiles.findIndex(f => f.path === file.path);
                
                if (existingIndex >= 0) {
                  // File is already open, switch to it
                  switchToFile(existingIndex);
                } else {
                  // Open new file
                  const newFile = {
                    id: Date.now().toString(),
                    title: file.name.replace('.txt', ''),
                    content: result.content,
                    path: file.path,
                    isModified: false
                  };
                  
                  openFiles.push(newFile);
                  createTabForFile(newFile, openFiles.length - 1);
                  switchToFile(openFiles.length - 1);
                }
                
                updateStatusMessage(`Opened: ${file.name}`);
              }
            } catch (error) {
              console.error('Failed to open file:', error);
              updateStatusMessage('Failed to open file', true);
            }
          });
          
          document.getElementById('file-explorer').appendChild(fileElement);
        };
      }
      
      if (originalSwitchToFile) {
        // Override switchToFile to use GitHub dark mode styling
        window.switchToFile = function(index) {
          // Call original function first to maintain functionality
          originalSwitchToFile(index);
          
          // Then apply the GitHub dark mode styling
          const tabs = document.querySelectorAll('#tabs-container > div');
          tabs.forEach(tab => {
            const tabIndex = parseInt(tab.dataset.index);
            if (tabIndex === index) {
              tab.classList.add('tab-active');
            } else {
              tab.classList.remove('tab-active');
            }
          });
        };
      }
      
      if (originalUpdateStatusMessage) {
        // Enhanced status message
        window.updateStatusMessage = function(message, isError = false) {
          // Call original first to maintain functionality
          originalUpdateStatusMessage(message, isError);
          
          // Then enhance the styling
          const statusElement = document.getElementById('status-message');
          statusElement.innerHTML = '';
          
          // Add icon
          const icon = document.createElement('i');
          icon.className = isError ? 'fas fa-exclamation-circle mr-1' : 'fas fa-check-circle mr-1';
          
          // Create styled message
          const messageSpan = document.createElement('span');
          messageSpan.textContent = message;
          
          // Style the container
          statusElement.className = isError 
            ? 'px-2 py-1 bg-[rgba(248,81,73,0.15)] text-[#f85149] rounded flex items-center animate-fadeIn' 
            : 'px-2 py-1 bg-[rgba(63,185,80,0.15)] text-[#3fb950] rounded flex items-center animate-fadeIn';
            
          // Append elements
          statusElement.appendChild(icon);
          statusElement.appendChild(messageSpan);
          
          // Auto-hide after delay
          setTimeout(() => {
            statusElement.style.opacity = '0';
            statusElement.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
              statusElement.innerHTML = '';
              statusElement.className = 'px-2';
              statusElement.style.opacity = '1';
            }, 500);
          }, 3000);
        };
      }
    });
  </script>
</body>
</html>